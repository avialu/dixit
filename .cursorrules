# Dixit Game - Development Guidelines

> **AI Assistant Rules**: Follow ALL guidelines in this file for EVERY response. This is mandatory.

---

## ğŸš¨ CRITICAL WORKFLOW - READ FIRST

### Before ANY Code Changes

1. âœ… **Read and understand** the relevant code sections
2. âœ… **Run tests** to establish baseline: `npm run build` (client)
3. âœ… **Check linter** errors for files you'll modify
4. âœ… **Verify** all imports resolve correctly

### After ANY Code Changes

1. âœ… **Run linter** on modified files
2. âœ… **Build client**: `cd client && npm run build`
3. âœ… **Test in browser** if UI changes (describe what you tested)
4. âœ… **No regressions** - existing features must still work

### If Build Fails

- âŒ **STOP** - Do not proceed to next task
- ğŸ” **Fix** TypeScript/build errors immediately
- âœ… **Verify** fix with another build
- ğŸ“ **Document** what was broken and how you fixed it

---

## ğŸ“± MOBILE-FIRST DESIGN PRINCIPLES

### Learn from the Best: Google, Instagram, X (Twitter)

#### 1. Touch Targets (Instagram, Twitter)

```typescript
// âŒ BAD - Too small for mobile
<button style={{ padding: '4px' }}>Click</button>

// âœ… GOOD - Minimum 44x44px touch target
<Button variant="primary" style={{ minHeight: '44px', minWidth: '44px' }}>
  Click
</Button>
```

#### 2. Thumb-Friendly Zones (Mobile Apps Standard)

- **Primary actions** â†’ Bottom 1/3 of screen (easy thumb reach)
- **Secondary actions** â†’ Middle 1/3 (stretch reach)
- **Informational content** â†’ Top 1/3 (scroll to view)

```typescript
// âœ… GOOD - Primary button at bottom
<div className="modal-footer">
  <Button variant="continue">Submit</Button>
</div>
```

#### 3. Progressive Disclosure (Google Apps)

- Show ONLY essential information first
- Hide advanced options behind "Show more" or settings
- Use modals/drawers for detailed info

```typescript
// âœ… GOOD - Simple first, details on demand
<Button onClick={() => setShowAdvanced(!showAdvanced)}>
  Advanced Options â–¼
</Button>;
{
  showAdvanced && <AdvancedSettings />;
}
```

#### 4. Immediate Feedback (Instagram-like)

- **Every tap** â†’ visual feedback (scale, color change)
- **Loading states** â†’ skeleton screens or spinners
- **Success/Error** â†’ clear, brief toast notifications

```typescript
// âœ… GOOD - Loading state
{
  uploading ? (
    <Button disabled>
      <span>â³</span> Uploading...
    </Button>
  ) : (
    <Button onClick={handleUpload}>Upload</Button>
  );
}
```

#### 5. Gesture Support (Twitter/Instagram)

- **Swipe** â†’ navigate back, dismiss modals
- **Pull-to-refresh** â†’ refresh content
- **Long-press** â†’ context menus, details

#### 6. Performance (All Top Apps)

- **Lazy load** images and heavy components
- **Optimize images** - use WebP, resize before upload
- **Debounce** search inputs (300ms minimum)
- **Virtual scrolling** for long lists (100+ items)

```typescript
// âœ… GOOD - Lazy loading
import { lazy, Suspense } from "react";
const HeavyComponent = lazy(() => import("./HeavyComponent"));

<Suspense fallback={<Spinner />}>
  <HeavyComponent />
</Suspense>;
```

#### 7. Accessibility (Google Standard)

- **aria-label** on all interactive elements
- **Keyboard navigation** (Tab, Enter, Escape)
- **Screen reader** support
- **High contrast** text (WCAG AA: 4.5:1 ratio)

```typescript
// âœ… GOOD - Accessible button
<Button variant="primary" aria-label="Submit your vote" onClick={handleVote}>
  Vote
</Button>
```

#### 8. Error States (Best Practice)

```typescript
// âœ… GOOD - Clear error messaging
{
  error && (
    <div role="alert" className="error-message">
      âš ï¸ {error}
      <Button variant="secondary" onClick={retry}>
        Try Again
      </Button>
    </div>
  );
}
```

---

## ğŸ¨ Component Location Rules

### UI Components (Single Source of Truth)

- ALL reusable UI components MUST be created in `client/src/components/ui/`
- These are primitive components: Button, Input, Badge, PlayerToken, CloseButton, Card, Icon
- Feature-specific components go in `client/src/components/`
- Page components go in `client/src/pages/`

### Component Hierarchy

```
client/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/              # âœ… Primitive UI components (Button, Badge, etc.)
â”‚   â”‚   â””â”€â”€ index.ts     # Barrel export
â”‚   â”œâ”€â”€ Modal.tsx        # âœ… Feature components
â”‚   â”œâ”€â”€ GameBoard.tsx    # âœ… Feature components
â”‚   â””â”€â”€ ...
â””â”€â”€ pages/               # âœ… Page-level components
    â””â”€â”€ UnifiedGamePage.tsx
```

## Using UI Components

### 1. Always Import from UI Library

```typescript
// âœ… GOOD
import { Button, Badge, PlayerToken, Icon, IconSize } from "../components/ui";

// âŒ BAD - Don't create inline buttons
<button className="btn-primary">Click</button>;
```

### 2. Button Usage

```typescript
// âŒ BAD
<button className="btn-primary">Submit</button>
<button className="btn-secondary">Cancel</button>
<button className="btn-continue">Continue</button>
<button className="btn-icon">âœ“</button>

// âœ… GOOD
<Button variant="primary">Submit</Button>
<Button variant="secondary">Cancel</Button>
<Button variant="continue">Continue</Button>
<Button variant="icon">âœ“</Button>

// âœ… GOOD - With size
<Button variant="primary" size="large">Join Game</Button>

// âœ… GOOD - Override className for edge cases
<Button variant="primary" className="custom-spacing">Submit</Button>
```

### 3. Badge Usage

```typescript
// âŒ BAD
<span className="admin-badge">ğŸ‘‘</span>
<span className="you-badge">(You)</span>

// âœ… GOOD
<Badge variant="admin" />
<Badge variant="you" />
<Badge variant="storyteller" />
<Badge variant="score" value={3} />
<Badge variant="votes" value={2} />
```

### 4. PlayerToken Usage

```typescript
// âŒ BAD - Duplicated color logic
<div style={{ background: colors[index % colors.length] }}>...</div>;

// âœ… GOOD
import { PlayerToken, getPlayerColor } from "../components/ui";

<PlayerToken
  imageUrl={player.tokenImage}
  playerColor={getPlayerColor(playerIndex)}
  size="small"
/>;
```

### 5. Input Usage

```typescript
// âŒ BAD
<input className="name-input-inline" />
<input className="clue-input-inline" />

// âœ… GOOD
<Input variant="inline" placeholder="Enter your name..." />
<Input variant="inline" placeholder="Enter your clue..." />
```

### 6. Icon Usage

**Icon Library: Lucide React**

We use [Lucide React](https://lucide.dev/) for all icons. It provides:

- âœ… **Better tree-shaking** â†’ Smaller bundle sizes
- âœ… **Consistent design** â†’ All icons from same design system
- âœ… **Full TypeScript support** â†’ Fully typed
- âœ… **Modern & clean** â†’ Professional appearance

```typescript
// âœ… GOOD - Import from UI library
import { Icon, IconSize } from "../components/ui";

// âœ… GOOD - Use predefined icons
<Icon.Settings size={IconSize.large} />
<Icon.QRCode size={IconSize.medium} />
<Icon.Rocket size={IconSize.large} />
<Icon.Card size={IconSize.large} />
<Icon.Vote size={IconSize.large} />
<Icon.Results size={IconSize.large} />
<Icon.Trophy size={IconSize.large} />
<Icon.People size={IconSize.large} />
<Icon.Logout size={IconSize.medium} />

// âœ… GOOD - Icon sizes
IconSize.small    // 16px
IconSize.medium   // 20px
IconSize.large    // 24px
IconSize.xlarge   // 32px
IconSize.xxlarge  // 48px

// âœ… GOOD - Icons with text
<Button variant="primary">
  <Icon.Rocket size={IconSize.medium} /> Join Game
</Button>

// âŒ BAD - Don't use emojis for UI icons
<button>ğŸš€ Join Game</button>
<h2>ğŸ‘¥ Players</h2>

// âŒ BAD - Don't import directly from lucide-react
import { Settings } from "lucide-react";
```

**Available Icons:**

- **Navigation**: Settings, Home, Menu, ArrowForward, ArrowBack, Close
- **Game Actions**: Rocket, Play, Pause, Refresh
- **Cards & Content**: Card, Images, Image, Camera
- **Voting & Scoring**: Vote, Checkmark, Results, Star, Heart, Trophy, Crown, Sparkles
- **Social & Players**: People, Share
- **Utilities**: QRCode, Logout, Trash, Upload, Download, Copy, Add, Remove, Search, Filter
- **Visibility & Info**: Eye, EyeOff, Info, Warning

**When to Use Icons vs Emojis:**

- âœ… **Icons**: UI elements, buttons, headers, navigation (professional, consistent)
- âœ… **Emojis**: User-generated content, flavor text, decorative elements (fun, expressive)

### 7. CloseButton Usage

```typescript
// âŒ BAD
<button className="modal-close-button" onClick={onClose}>Ã—</button>

// âœ… GOOD
<CloseButton onClose={onClose} />
```

**X Button Standards - SINGLE SOURCE OF TRUTH:**

All X buttons MUST use the `.x-button` base class:

```css
/* global.css - SINGLE SOURCE OF TRUTH for all X buttons */
.x-button {
  background: #e74c3c;
  color: white;
  border: 2px solid #fff;
  border-radius: 50%;
  /* ... all styling defined once */
}
```

**Usage in Components:**

```typescript
// âœ… GOOD - Always include x-button class
<button className="x-button modal-close-button">Ã—</button>
<button className="x-button profile-upload-remove">Ã—</button>
<button className="x-button preview-delete-btn">Ã—</button>

// âŒ BAD - Missing x-button base class
<button className="modal-close-button">Ã—</button>
```

**Rules:**

- âœ… `.x-button` defines ALL core styling (color, shape, hover, active)
- âœ… Specific classes (`.modal-close-button`) only define position and size
- âœ… Always use `Ã—` character (multiplication sign)
- âœ… Never duplicate the core styling - extend `.x-button` only

## Type Safety Rules

### Strict Variants with Escape Hatch

- All UI components have strict TypeScript variants
- Use `className` prop to override/extend styles when needed
- Prefer adding new variants over using className hacks

```typescript
// âœ… Type-safe variants
variant: "primary" | "secondary" | "continue" | "icon"

// âœ… Escape hatch when needed
<Button variant="primary" className="special-case">...</Button>
```

## When to Add New Variants

If you find yourself doing this:

```typescript
<Button className="btn-custom-style">New Action</Button>
```

Consider instead:

1. Is this a one-off? Keep the className override
2. Will this be reused? Add a new variant to the Button component
3. Update the Button.tsx component
4. Export the new variant type
5. Document it in this file

## Color Palette

### Player Token Colors

Use the exported constant for consistency:

```typescript
import { PLAYER_TOKEN_COLORS, getPlayerColor } from "../components/ui";

// Available colors (in order):
// #f39c12 (Orange)
// #3498db (Blue)
// #2ecc71 (Green)
// #e74c3c (Red)
// #9b59b6 (Purple)
// #1abc9c (Teal)
```

## Testing New Components

When creating a new UI component:

1. Create the file in `client/src/components/ui/`
2. Export it from `client/src/components/ui/index.ts`
3. Document variants and props in the component file
4. Add usage examples to this .cursorrules file
5. Update existing code to use the new component

## Common Mistakes to Avoid

### âŒ DON'T

```typescript
// Don't create inline styled buttons
<button style={{...}}>Click</button>

// Don't use className for variants
<button className="btn-primary btn-large">...</button>

// Don't duplicate color logic
const colors = ["#f39c12", "#3498db", ...];

// Don't create one-off badge components
<span className="my-custom-badge">Text</span>

// Don't use emojis for UI icons
<button>ğŸš€ Start</button>
<h2>ğŸ‘¥ Players</h2>

// Don't import icons directly from lucide-react
import { Settings } from "lucide-react";
```

### âœ… DO

```typescript
// Use the Button component with icons
<Button variant="primary" size="large">
  <Icon.Rocket size={IconSize.medium} /> Start Game
</Button>;

// Import from UI library
import { Button, Icon, IconSize, getPlayerColor } from "../components/ui";

// Use Badge component
<Badge variant="admin" />;

// Use Icon component for UI elements
<Icon.Settings size={IconSize.large} />;

// Add new variants when reusable
// (Edit Button.tsx to add "danger" variant, etc.)
```

## Migration Checklist

When refactoring old code:

- [ ] Replace all `<button className="btn-*">` with `<Button variant="*">`
- [ ] Replace all badge spans with `<Badge variant="*" />`
- [ ] Replace token rendering with `<PlayerToken />`
- [ ] Replace inputs with `<Input variant="*" />`
- [ ] Replace close buttons with `<CloseButton />`
- [ ] Replace emoji icons with `<Icon.* />` components
- [ ] Import from `"../components/ui"`

## Benefits of This System

1. **Single Source of Truth** - Change button styles once, updates everywhere
2. **Type Safety** - Catch typos at compile time (variant="primray" â†’ error)
3. **Consistency** - Same look and feel across all pages
4. **Maintainability** - Easy to find and update component logic
5. **Developer Experience** - Clear, documented patterns
6. **Accessibility** - Centralized aria labels and keyboard handling

---

## ğŸ§ª TESTING & QUALITY ASSURANCE

### Required Testing Steps

#### For UI Component Changes

1. âœ… **Visual test** all variants of the component
2. âœ… **Test on mobile viewport** (375px width minimum)
3. âœ… **Test interactions** (click, hover, focus, disabled states)
4. âœ… **Verify accessibility** (keyboard navigation, screen reader)

#### For Feature Changes

1. âœ… **Happy path** - main user flow works
2. âœ… **Edge cases** - empty states, errors, loading
3. âœ… **Mobile + Desktop** - responsive behavior
4. âœ… **Network conditions** - slow connection handling

#### Build Verification (MANDATORY)

```bash
# Client build - MUST PASS before completing task
cd client && npm run build

# If fails, fix TypeScript errors immediately
# Common issues:
# - Missing imports
# - Type mismatches
# - Unused variables
# - Invalid prop types
```

---

## ğŸ¯ CODE QUALITY STANDARDS

### TypeScript Best Practices

```typescript
// âœ… GOOD - Explicit types
interface ButtonProps {
  variant: "primary" | "secondary";
  onClick: () => void;
  children: ReactNode;
}

// âŒ BAD - Any types
function doSomething(data: any) {}

// âœ… GOOD - Proper typing
function doSomething(data: UserData) {}
```

### React Best Practices (From Top Apps)

#### 1. State Management

```typescript
// âŒ BAD - Unnecessary re-renders
const [data, setData] = useState(bigObject);

// âœ… GOOD - Only store what you need
const [userId, setUserId] = useState(bigObject.id);
```

#### 2. Use Hooks Correctly

```typescript
// âŒ BAD - Hooks in conditions
if (condition) {
  useEffect(() => {}, []);
}

// âœ… GOOD - Hooks at top level
useEffect(() => {
  if (condition) {
    // logic here
  }
}, [condition]);
```

#### 3. Memoization (Performance)

```typescript
// âœ… GOOD - Expensive calculations
const sortedList = useMemo(
  () => data.sort((a, b) => a.score - b.score),
  [data]
);

// âœ… GOOD - Callback stability
const handleClick = useCallback(() => {
  doSomething(id);
}, [id]);
```

### CSS Best Practices

#### Mobile-First Media Queries

```css
/* âœ… GOOD - Mobile first, then scale up */
.button {
  padding: 12px; /* Mobile */
}

@media (min-width: 768px) {
  .button {
    padding: 16px; /* Desktop */
  }
}

/* âŒ BAD - Desktop first */
.button {
  padding: 16px;
}

@media (max-width: 768px) {
  .button {
    padding: 12px;
  }
}
```

#### Use CSS Variables

```css
/* âœ… GOOD - Reusable colors */
:root {
  --primary-color: #667eea;
  --spacing-unit: 8px;
}

.button {
  background: var(--primary-color);
  padding: calc(var(--spacing-unit) * 2);
}
```

---

## âš¡ PERFORMANCE GUIDELINES

### Image Optimization (Instagram/Twitter Standard)

```typescript
// âœ… GOOD - Resize before upload
import { resizeAndCompressImage } from "../utils/imageResize";

const handleUpload = async (file: File) => {
  const optimized = await resizeAndCompressImage(file);
  // Max 800x600, quality 0.8, converts to WebP
  onUpload(optimized);
};
```

### Lazy Loading

```typescript
// âœ… GOOD - Load on demand
const GameBoard = lazy(() => import("./GameBoard"));

// Use Suspense wrapper
<Suspense fallback={<LoadingSpinner />}>
  <GameBoard />
</Suspense>;
```

### Debouncing (Search/Input)

```typescript
// âœ… GOOD - Debounce expensive operations
const debouncedSearch = useMemo(
  () => debounce((query) => fetchResults(query), 300),
  []
);
```

---

## ğŸš€ DEPLOYMENT CHECKLIST

Before marking any task complete:

- [ ] âœ… All TypeScript errors fixed
- [ ] âœ… Build passes (`npm run build`)
- [ ] âœ… No console errors in browser
- [ ] âœ… Mobile viewport tested (375px - 768px)
- [ ] âœ… Desktop viewport tested (1024px+)
- [ ] âœ… Loading states work correctly
- [ ] âœ… Error states display properly
- [ ] âœ… Accessibility: keyboard navigation works
- [ ] âœ… UI components imported from `components/ui/`
- [ ] âœ… No inline buttons, badges, or inputs
- [ ] âœ… Existing features still work (no regressions)

---

## ğŸ“š LEARNING FROM TOP APPS

### Google Material Design

- **Elevation** - Use shadows to show hierarchy
- **Motion** - 300ms transitions for smoothness
- **Density** - Compact on mobile, spacious on desktop

### Instagram

- **Instant feedback** - Every action has visual response
- **Optimistic updates** - Show changes immediately, sync later
- **Pull-to-refresh** - Standard gesture for refresh

### X (Twitter)

- **Infinite scroll** - Seamless content loading
- **Skeleton screens** - Show layout while loading
- **Minimal UI** - Clean, distraction-free interface

### Common Patterns

1. **Bottom sheets** (mobile) vs **side panels** (desktop)
2. **FAB buttons** (Floating Action Button) for primary actions
3. **Snackbars/Toasts** for brief notifications (3-5 seconds)
4. **Empty states** with helpful CTAs
5. **Search** with instant results (debounced)

---

## â“ Decision Framework

### When Adding Features

1. **Is it mobile-first?** Start with mobile viewport
2. **Is it accessible?** Can be used with keyboard only
3. **Is it performant?** <100ms interaction response
4. **Is it tested?** Works on mobile AND desktop
5. **Uses design system?** Import from `components/ui/`

### When Fixing Bugs

1. **Reproduce** the issue first
2. **Understand** root cause (don't guess)
3. **Fix** with minimal changes
4. **Test** the fix thoroughly
5. **Verify** no new issues introduced

### Questions?

If unsure about whether to create a new component or variant:

1. Is it reused 3+ times? â†’ Component or variant
2. Is it a one-off special case? â†’ className override
3. Is it feature-specific? â†’ `components/` not `components/ui/`
4. Is it a primitive (button, input, badge)? â†’ `components/ui/`

---

## ğŸ“ REMEMBER

> "Make it work, make it right, make it fast" - Kent Beck

1. **Always** use UI components from `components/ui/`
2. **Always** run build after changes
3. **Always** test on mobile viewport
4. **Always** consider accessibility
5. **Never** use inline buttons, badges, or inputs
6. **Never** skip testing steps
7. **Never** commit code that doesn't build

**This is a multiplayer game - performance and mobile UX are critical!**
